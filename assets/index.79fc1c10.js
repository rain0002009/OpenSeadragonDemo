var V=Object.defineProperty,z=Object.defineProperties;var R=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var x=(o,t,r)=>t in o?V(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,b=(o,t)=>{for(var r in t||(t={}))W.call(t,r)&&x(o,r,t[r]);if(S)for(var r of S(t))H.call(t,r)&&x(o,r,t[r]);return o},F=(o,t)=>z(o,R(t));var h=(o,t,r)=>(x(o,typeof t!="symbol"?t+"":t,r),r);import{u as N,j as u,a,S as D,C as Z,B as g,P as O,I as j,M as I,o as p,_ as w,b as _,r as $,c as v,O as Y,R as q,d as X}from"./vendor.8dee95b0.js";const K=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function r(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerpolicy&&(s.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?s.credentials="include":e.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(e){if(e.ep)return;e.ep=!0;const s=r(e);fetch(e.href,s)}};K();const U=[{type:"circle",label:"\u5706\u5F62"},{type:"rect",label:"\u77E9\u5F62"},{type:"line",label:"\u76F4\u7EBF"},{type:"free",label:"\u81EA\u7531"},{type:"text",label:"\u6587\u5B57"}],G=({onChange:o})=>{const t=N({strokeWeight:10,opacity:1,color:"#3f51b5",type:null});return u("div",{className:"w-230px space-y-4",children:[u("div",{children:[a("p",{children:"\u753B\u7B14\u7C97\u7EC6\uFF1A"}),a(D,{min:10,max:100,onChange:r=>{t.strokeWeight=r}})]}),u("div",{children:[a("p",{children:"\u900F\u660E\u5EA6\uFF1A"}),a(D,{min:.1,max:1,step:.1,defaultValue:1,onChange:r=>{t.opacity=r}})]}),u("div",{children:[a("p",{children:"\u989C\u8272\uFF1A"}),a(Z,{onChange:r=>{t.color=r.hex}})]}),u("div",{children:[a("p",{children:"\u7C7B\u578B\uFF1A"}),a("div",{className:"grid grid-cols-3 gap-1",children:U.map(({type:r,label:i})=>a(g,{onClick:()=>{t.type=r,o==null||o(t)},children:i},r))})]})]})},{Item:L}=I,J=[{type:"fullscreen",label:"\u5168\u5C4F"},{type:"home",label:"\u4E3B\u9875"}],Q=({viewer:o,sk:t,drawMethod:r,markerStore:i})=>{const e=N({markVisibility:!1,inputVisibility:!1,inputText:""});return t?u("div",{className:"ml-auto w-100px",children:[a(O,{zIndex:10,visible:e.inputVisibility,content:u("div",{className:"space-y-4 w-300px",children:[a(j,{autoFocus:!0,value:e.inputText,onChange:s=>{e.inputText=s.target.value}}),u("div",{className:"flex",children:[a(g,{onClick:()=>{e.inputVisibility=!1,e.inputText="",t.noLoop(),o.setMouseNavEnabled(!0),r.drawOptions.enable=!1},children:"\u53D6\u6D88"}),a(g,{type:"primary",className:"ml-auto",onClick:()=>{e.inputVisibility=!1,r.drawOptions.isInputOk=!0,i.push(F(b({},r.drawOptions),{path:[[r.drawOptions.startPointTransformed.x,r.drawOptions.startPointTransformed.y]],text:e.inputText})),t.noLoop(),o.setMouseNavEnabled(!0),e.inputText="",r.drawOptions.enable=!1},children:"\u786E\u8BA4"})]})]}),children:a("div",{id:"inputWrap"})}),u(I,{mode:"inline",className:"border border-color-[#dedede] shadow",children:[J.map(({type:s,label:c})=>a(L,{onClick:({key:l})=>{switch(l){case"fullscreen":o.setFullScreen(!0);break;case"home":o.viewport.goHome(!0);break}},children:c},s)),a(O,{placement:"leftTop",title:a("p",{children:"\u6807\u6CE8"}),content:a(G,{onChange:s=>{e.markVisibility=!1,r.drawOptions=s,r.startDraw(()=>{e.inputVisibility=!0})}}),trigger:"click",visible:e.markVisibility,children:a(L,{style:{paddingLeft:24},onClick:()=>{e.markVisibility=!e.markVisibility},children:"\u6807\u6CE8"},"mark")})]})]}):null};class ee{constructor(t,r){h(this,"viewer");h(this,"wrapDiv");h(this,"sk");h(this,"drawMethod");h(this,"markerStore");h(this,"ControlPanel");this.ControlPanel=r.ControlPanel||Q,this.markerStore=r.markerStore||[],this.viewer=t,this.wrapDiv=document.createElement("div"),this.wrapDiv.classList.add("p5-wrap"),this.viewer.canvas.append(this.wrapDiv),this.drawMethod={drawOptions:{},startDraw:i=>{this.drawMethod.drawOptions.enable=!0,t.setMouseNavEnabled(!1),this.drawMethod.drawOptions.startPoint=null,this.drawMethod.drawOptions.endPoint=null,this.drawMethod.drawOptions.startPointTransformed=null,this.drawMethod.drawOptions.freePath=[],this.sk.loop(),this.sk.mousePressed=()=>{var e;if(this.drawMethod.drawOptions.startPoint=new p.exports.Point(this.sk.mouseX,this.sk.mouseY),((e=this.drawMethod.drawOptions)==null?void 0:e.type)==="text"){const s=this.sk.select("#inputWrap");s?(s==null||s.position(this.drawMethod.drawOptions.startPoint.x,this.drawMethod.drawOptions.startPoint.y),i==null||i()):console.error("inputWrap is null")}},this.sk.mouseReleased=()=>{var s,c;if(((s=this.drawMethod.drawOptions)==null?void 0:s.type)==="text")return this.sk.mousePressed=w.noop,!1;this.drawMethod.drawOptions.enable=!1,this.sk.noLoop(),t.setMouseNavEnabled(!0),this.sk.mousePressed=w.noop;const e=b({},this.drawMethod.drawOptions);switch((c=this.drawMethod.drawOptions)==null?void 0:c.type){case"circle":case"rect":case"line":e.path=[[this.drawMethod.drawOptions.startPointTransformed.x,this.drawMethod.drawOptions.startPointTransformed.y],[this.drawMethod.drawOptions.endPoint.x,this.drawMethod.drawOptions.endPoint.y]];break;case"free":e.path=this.drawMethod.drawOptions.freePath;break}this.markerStore.push(e),this.drawMethod.drawOptions={},this.sk.mouseReleased=w.noop}},draw:(i,e,s,c,l)=>{var m,f,C,k;if(s===1?e.enable&&i.mouseIsPressed&&e&&e.startPoint&&i.mouseButton===i.LEFT:!0){i.push();const P=i.color(e.color);P.setAlpha(i.map(e.opacity,0,1,0,255)),e.startPointTransformed=l==null?void 0:l.viewerElementToImageCoordinates(e.startPoint),e.endPoint=l==null?void 0:l.viewerElementToImageCoordinates(new p.exports.Point(i.mouseX,i.mouseY));let n,d;const E=e.strokeWeight*t.viewport.getMinZoom()/t.viewport.getHomeZoom();switch(s===1?(n=e.startPointTransformed,d=e.endPoint):(n=new p.exports.Point(...e.path[0]),d=new p.exports.Point(...((m=e.path)==null?void 0:m[1])||[0,0])),["circle","rect","line","free"].includes(e.type)&&(i.noFill(),i.strokeWeight(E*2),i.stroke(P)),e==null?void 0:e.type){case"circle":i.circle(n.x,n.y,n.distanceTo(d)*2);break;case"rect":i.quad(n.x,n.y,d.x,n.y,d.x,d.y,n.x,d.y);break;case"line":i.line(n.x,n.y,d.x,d.y);break;case"free":s==1&&(((f=e.freePath)==null?void 0:f.length)===0&&e.freePath.push([n.x,n.y]),new p.exports.Point(...w.last(e.freePath)).distanceTo(d)>20&&((C=e.freePath)==null||C.push([d.x,d.y]))),(k=e[s===1?"freePath":"path"])==null||k.forEach((A,B)=>{var T;const M=(T=e.freePath)==null?void 0:T[B+1];M&&i.line(...A,...M)});break;case"text":(s===1?e.isInputOk:!0)&&(i.textSize(E*25),i.fill(P),i.text(e.text,n.x,n.y));break}i.pop()}}},this.sk=new _(i=>{i.setup=()=>{i.createCanvas(this.viewer.container.clientWidth,this.viewer.container.clientHeight),i.noLoop(),this.addControl()},i.draw=()=>{let e=this.viewer.viewport.getZoom(!0);i.clear();for(let s=0,c=this.viewer.world.getItemCount();s<c;s++){let l=this.viewer.world.getItemAt(s);if(l){let y=l.viewportToImageZoom(e),m=l.imageToViewportCoordinates(0,0,!0),f=this.viewer.viewport.pixelFromPoint(m,!0);i.translate(f.x,f.y),i.scale(y,y),this.drawMarkStore(e),this.drawMethod.draw(i,this.drawMethod.drawOptions,1,e,l)}}}},this.wrapDiv),this.viewer.addHandler("open",this.redraw.bind(this)),this.viewer.addHandler("update-viewport",this.redraw.bind(this)),this.viewer.addHandler("resize",this.resizeCanvas.bind(this))}resizeCanvas(){var t;(t=this.sk)==null||t.resizeCanvas(this.viewer.container.clientWidth,this.viewer.container.clientHeight,!1)}redraw(){var t;(t=this.sk)==null||t.redraw()}addControl(){const t=document.createElement("div");t.classList.add("flex","w-full","relative"),this.viewer.container.append(t),setTimeout(()=>{$.exports.render(v.exports.createElement(this.ControlPanel,this,null),t)},0)}setMarkStore(t){this.markerStore=t,this.redraw()}drawMarkStore(t){this.markerStore.forEach(r=>{this.drawMethod.draw(this.sk,r,2,t)})}}function te(){const o=v.exports.useRef(null),t=v.exports.useRef(new p.exports.TileSource({width:7026,height:9221,tileSize:256,tileOverlap:2,getTileUrl(r,i,e){return`//openseadragon.github.io//example-images/highsmith/highsmith_files/${r}/${i}_${e}.jpg`}}));return v.exports.useEffect(()=>{let r;return o.current&&(r=Y({element:o.current,showNavigationControl:!1,showNavigator:!0,navigatorAutoFade:!1,navigatorAutoResize:!1,navigatorHeight:100,navigatorWidth:200,navigatorPosition:"TOP_LEFT",tileSources:[t.current],gestureSettingsMouse:{dblClickToZoom:!1,clickToZoom:!1}}),new ee(r,{})),()=>{r.destroy()}},[o.current]),a("div",{children:a("div",{className:"h-100vh w-full z-1",ref:o})})}q.render(a(X.StrictMode,{children:a(te,{})}),document.getElementById("root"));
